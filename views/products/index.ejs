<%- include('../partials/header') %>

<!-- Vue de la liste des produits -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Liste des produits</h1>
    <a href="/products/create" class="btn btn-primary">Ajouter un produit</a>
</div>

<!-- Formulaire de filtrage -->
<div class="card mb-4">
    <div class="card-body">
        <form method="GET" action="/products" class="row g-3">
            <div class="col-md-3">
                <input type="text" name="search" class="form-control" placeholder="Rechercher..." value="<%= typeof filters !== 'undefined' && filters.search ? filters.search : '' %>">
            </div>
            <div class="col-md-2">
                <select name="category" class="form-select">
                    <option value="">Toutes les catégories</option>
                    <option value="Électronique" <%= typeof filters !== 'undefined' && filters.category === 'Électronique' ? 'selected' : '' %>>Électronique</option>
                    <option value="Vêtements" <%= typeof filters !== 'undefined' && filters.category === 'Vêtements' ? 'selected' : '' %>>Vêtements</option>
                    <option value="Alimentation" <%= typeof filters !== 'undefined' && filters.category === 'Alimentation' ? 'selected' : '' %>>Alimentation</option>
                    <option value="Livres" <%= typeof filters !== 'undefined' && filters.category === 'Livres' ? 'selected' : '' %>>Livres</option>
                    <option value="Autres" <%= typeof filters !== 'undefined' && filters.category === 'Autres' ? 'selected' : '' %>>Autres</option>
                </select>
            </div>
            <div class="col-md-2">
                <select name="inStock" class="form-select">
                    <option value="">Tous</option>
                    <option value="true" <%= typeof filters !== 'undefined' && filters.inStock === 'true' ? 'selected' : '' %>>En stock</option>
                </select>
            </div>
            <div class="col-md-2">
                <input type="number" name="minPrice" class="form-control" placeholder="Prix min" value="<%= typeof filters !== 'undefined' && filters.minPrice ? filters.minPrice : '' %>">
            </div>
            <div class="col-md-2">
                <input type="number" name="maxPrice" class="form-control" placeholder="Prix max" value="<%= typeof filters !== 'undefined' && filters.maxPrice ? filters.maxPrice : '' %>">
            </div>
            <div class="col-md-1">
                <button type="submit" class="btn btn-secondary w-100">Filtrer</button>
            </div>
        </form>
    </div>
</div>

<!-- Liste des produits -->
<% if (products && products.length > 0) { %>
    <div class="row">
        <% products.forEach(product => { %>
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title"><%= product.name %></h5>
                        <p class="card-text">
                            <span class="badge bg-<%= product.category === 'Électronique' ? 'primary' : product.category === 'Vêtements' ? 'success' : product.category === 'Alimentation' ? 'warning' : product.category === 'Livres' ? 'info' : 'secondary' %>">
                                <%= product.category %>
                            </span>
                            <% if (product.inStock) { %>
                                <span class="badge bg-success">En stock</span>
                            <% } else { %>
                                <span class="badge bg-danger">Rupture de stock</span>
                            <% } %>
                        </p>
                        <p class="card-text"><strong>Prix:</strong> <%= product.formattedPrice %></p>
                        <% if (product.description) { %>
                            <p class="card-text text-muted"><%= product.description.substring(0, 100) %>...</p>
                        <% } %>
                    </div>
                    <div class="card-footer">
                        <a href="/products/<%= product._id %>" class="btn btn-sm btn-primary">Voir détails</a>
                        <a href="/products/<%= product._id %>/edit" class="btn btn-sm btn-warning">Modifier</a>
                    </div>
                </div>
            </div>
        <% }); %>
    </div>

    <!-- Pagination -->
    <% if (pagination && pagination.totalPages > 1) { %>
        <nav aria-label="Navigation des pages">
            <ul class="pagination justify-content-center">
                <% if (pagination.page > 1) { %>
                    <li class="page-item">
                        <a class="page-link" href="?page=<%= pagination.page - 1 %><%= typeof filters !== 'undefined' && filters.search ? '&search=' + filters.search : '' %><%= typeof filters !== 'undefined' && filters.category ? '&category=' + filters.category : '' %>">Précédent</a>
                    </li>
                <% } %>
                
                <% for (let i = 1; i <= pagination.totalPages; i++) { %>
                    <li class="page-item <%= i === pagination.page ? 'active' : '' %>">
                        <a class="page-link" href="?page=<%= i %><%= typeof filters !== 'undefined' && filters.search ? '&search=' + filters.search : '' %><%= typeof filters !== 'undefined' && filters.category ? '&category=' + filters.category : '' %>"><%= i %></a>
                    </li>
                <% } %>
                
                <% if (pagination.page < pagination.totalPages) { %>
                    <li class="page-item">
                        <a class="page-link" href="?page=<%= pagination.page + 1 %><%= typeof filters !== 'undefined' && filters.search ? '&search=' + filters.search : '' %><%= typeof filters !== 'undefined' && filters.category ? '&category=' + filters.category : '' %>">Suivant</a>
                    </li>
                <% } %>
            </ul>
        </nav>
    <% } %>
<% } else { %>
    <div class="alert alert-info">
        <p>Aucun produit trouvé. <a href="/products/create">Ajoutez votre premier produit</a></p>
    </div>
<% } %>

<%- include('../partials/footer') %>

